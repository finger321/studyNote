1.链路层的功能：
>向下：利用物理层提供的位流服务
>向上：向网络层提供明确的服务接口	
>>1）无确认的无连接服务
>>2）有确认的无连接服务
>>3)   有确认的有链接服务:建立链路、传输数据、释放链路
>> 注：有连接一定有确认

>具体功能:
>>1）链路管理，负责节点-节点的数据传输
>>2）组帧
>>3）物理寻址
>>4）流量控制
>>5）差错控制
>>6）访问控制

2.组帧:
>将网络层的数据封装成数据帧发送，将一段数据的前后分别添加首部和尾部就组成了数据帧。之所要将比特组合成帧是为了在出错时只需要重发出错的帧，无需重发全部数据。组帧主要解决帧定界、帧同步、透明传输。
>帧同步：从物理层接收的比特流中准确区分出一阵的开始和结束.
四种方法:
>>1）字节计数法：在帧的头部使用一个计数字段来表明帧内字符数，如果计数字段出错就无法判断帧的结束位置以及下一帧的开始位置
>>
>>2）字符填充的首位定界符法：使用特定字符来定界一帧的开始与结束，SOH表示开始，EOT表示结束。信息位中的特殊字符使用转义字符ESC
>>
>>3）零比特填充的首位定界符法，使用01111110表示一帧的开始与结束，发送方在信息位遇到五个连续的1则在后面插入一个0，接收方遇到五个连续的1则删除后面的0，如果后面不是零则表示界定符
>>
>>4）违规编码法：在物理层进行比特编码时使用违规编码法，使用违规编码表示界定符

3.差错控制：
>检错编码：在有效数据被发送前按照某种关系添加一定的冗余位。
>>1）奇偶校验码 ：
>>>a）奇校验码：附加一个校验码后，码字中1的个数位奇数
>>>b）偶校验码：附加一个校验码后，码字中1的个数位偶数	  	
>>>只能够检测奇数位的出错情况。

>>2）校验和(checksum)
>>>a）将数据划分位16位的二进制整数序列
>>>b）将整数求和，如果有进位则加到最低位
>>>c）最后将和取反

>>3）循环冗余校验码(Cyclic Redundancy Code)
>>>通信双方选择一个生成比特模式G(一个多项式，r+1位)，目标得到一个r位的CRC比特R。
>>>在D的后面添加r位的0得到$D*2^{r}$,然后对G进行模二除法，得到的余数即为r
>>>接收方使用<D,r>对G同样进行模二除法，如果能够整除则没有产生差错，否则产生差错。
>>>可以检测所有突发长度小于r+1位的错误.

>纠错编码：在有效信息位中插入几个校验位形成汉明码
>>1）汉明距离：两个码字之间对应位不同的数目
>>>{0000，0101，1010，1111}的海明距离位2

>>2）对于纠错码如果编码集的汉明距离位   $d_{s}=r+1$,则该差错编码可以检测出r位错误, 对于纠错码如果编码集的汉明距离位$d_{s}=2r+1$,则该差错编码可以纠正出r位错误。
>>3）确定海明码的位数:设n为有效信息的位数，k为校验位的位数，则$n+k\leq 2^{k}-1$.

4.流量控制与可靠传输机制
>可靠：不错、不丢、不乱、不多
>停-等协议：接收方每发送一帧，都要等待确认信号，才能继续发送下一帧，接收方每接收一帧都发送一个确认信号
>>1）rdt1.0：底层信道完全可靠，不会发生错误、不会丢弃分组
>>2）rdt2.0：可能产生位错误的信道
>>>解决方法：引入差错检测、反馈消息ACK/NAK，重传机制
>>>a）利用校验和检测位错误
>>>b）使用确认机制ACK：显示告诉发送方成功接收分组，NAK：显式地告诉发送方分组有错误
>>>c）发送方接收到NAK后，重传分组。
>>>基于重传奇数的rdt协议称为ARQ(Automatic Repeat reQuest)

>>3）rdt2.1：rdt2.0中如果ACK/NAK坏掉则会产生重复分组
>>>解决方法：发送方给没个分组增加序列号，接收方丢弃重复分组，这里只需要(0,1)作为序列号就够用因为这是停-等协议，数据帧一帧一帧的确认。

>>4）rdt2.2：在rdt2.1的基础上去掉NAK，只是用ACK，使用ACK告知最后一个被正确接收的分组
>>5）rdt3.0：信道既可能发生错误，也可能丢失分组，丢失分组的话，发送方会一直等到
>>>解决方法：发送发等待合理时间，需要计时器
>>>如果没有收到ACK，重传
>>>如果分组活ACK只是延迟而不是丢了，序号机制保证了会丢弃重复接收的分组
>>>在计时器超时的时候重传分组，并且重置计时器
>>>性能分析：
>>>$T_{transmission}=L(packet\ length\ in\ bits)/R(transmission\ rate,\ bps)$				 
>>>发送方利用率：发送方发送时间百分比
>>>$U_{sender}=T_{transmission}/(RTT+T_{transmission})$
>>>$U_{stop-wait}=t_{seg}/(t_{seg}+RTT+t_{ack})$

>流水线协议：允许发送方在收到ACK之前连续发送多个分组：这需要更大的序列号范围，发送/接收方都需要更大的存储空间以缓存分组。

>滑动窗口协议：
>>发送窗口：一组连续的允许发送的帧的序号	
>>接收串口：一组连续的允许接收的帧的序号
>>发送端每接收到一个确认帧，发送窗口就向前滑动一个帧的位置，如果窗口内没有可以发送的帧则停止发送。
>>接收端收到数据帧后，将窗口前移一个位置，并且返回一个确认帧
>>滑动窗口协议信道利用率：
>>>$U=W_{s}*t_{seg}/(t_{seg}+RTT+t_{ack})$

>>1）GBN(Go-Back-N)协议
>>>发送方:窗口尺寸为N，ACK(N)确认收到序列号n(包含n)的分组已经被正确接收。发送方每发送完一帧就要为这个帧设置超时计时器，如果发送方已经发送了N个帧，但是第一个帧在计时器超时后没有收到确认信息，则重发这N个帧。
>>>
>>>接收方：窗口尺寸为1，对于乱序到达的分组直接丢弃并且重新确认序列号最大、顺序到达的分组。

>> 2）SR(Selective Repaet)协议
>>>GBN协议的缺点：在重传时必须把原来已经传送正确的数据帧进行重传。
>>>SR协议的改进：     
>>>>a）接收方对每个分组单独进行确认,设置缓存机制，缓存乱序到达的分组
>>>>b）发送方值重传那些没有收到ACK的分组：同样需要为每个分组设置计时器
>>>>c）发送方窗口为N
>>>>d）接收方窗口通常与发送方相同，并且满足$W_{s}+W_{r} = 2^{n}$，采用n比特对帧进行编号，故$W_s =2^{n-1}$。

5.介质访问控制协议MAC(Medium Access Control)：为使用介质的每个结点隔离来自同一信道上其他结点所传送的信号，以协调活动结点的传输。
>给定一个速率为R bps的广播信道
>期望：
>>1）如果只有一个结点希望传输数据，可以以速率R发送
>>2）如果有M个结点希望传输数据，每个结点的平均速率为R/M
>>3）完全分散控制：无需特定结点协调、无需时钟、时隙同步
>>4）简单

>信道划分MAC协议：多路复用技术
>>1）时分多路复用(TDMA)
>>>将一条物理信道按时间分成若干时间片，轮流地分配给多个信号使用。通常一个用户对已经分配到子信道的利用率一般不高，STDM为改进方法，动态的分配时）隙。

>>2）频分多路复用(FDMA)
>>>将多路基带信号调制到不同频率载波上，再叠加形成一个复合信号的多路复用技术。子信道分配的带宽可以不同但它们的和不能超过信道的总带宽。

>>3）波分多路复用(WDMA)
>>>波分多路复用即光的频分多路复用，再一根光纤中传输多种不同波长的光信号，最后用波长分解复用器将各路波长分解出来。   

>>4）码分多路复用(CDMA)

>随机访问MAC协议：用户可以根据自己的意愿随机的发送信息，占用信道的全部速率。
>>随机访问MAC协议需要解决：
>>>如何检测冲突：当两个及以上结点同时传输。
>>>从冲突中恢复：通过延迟重传

>>时隙ALOHA协议:
>>>a）所有的数据帧大小相同
>>>b）将时间划分为等长的时隙(每个时隙刚好可以传输一个帧)
>>>c）结点只在时隙开始时刻发送数据帧
>>>d）结点间时钟同步
>>>e）如果2个或者2个以上结点再同一时隙发送数据帧即产生了冲突
>>>运行时：
>>>>如果结点有新的帧需要发送，在下一个时隙发送
>>>>如果无冲突，该结点可以在下一个时隙继续发送数据帧
>>>>如果有冲突，该在下一个时隙以概率p重传该数据帧，直到成功

>>>优点：
>>>>单个结点活动时，可以连续以信道全部速率发送数据帧
>>>>高度分散化：只需要同步时隙
>>>>简单

>>>缺点：
>>>>冲突，浪费时隙
>>>>空闲时隙
>>>>结点允许能够以远小于分组传输时间检测到冲突
>>>>时钟同步

>>>效率：
>>>>假设系结点个数为N，重传概率为P
>>>>则一个时隙成功发送数据帧的概率为$p(1-p)^{N-1}$
>>>>任意结点成功发送的概率为$Np(1-p)^{N-1}$
>>>>N无穷大时，最大效率为1/e

>>纯ALOHA协议：
>>>无须同步，结点在有新的数据帧要发送时，立即发送。在时刻$t_0$发送，会与在$[t_{0}-1,t_{0}+1]$期间其他结点发送的帧冲突
>>>P(给定结点成功发送数据帧) = $p*(1-p)^{N-1}*(1-p)^{N-1}$=$p(1-p)^{2(N-1)}$
>>>当N无穷大P=1/(2e)

>载波监听多路访问协议CSMA(carrier sense multiple access)
>>发送数据帧之前监听信道，如果信道空闲则发送完整帧，信道忙则推迟发送。由于信号的传播延迟，这种方式任然可能产生冲突。
>>1）1-坚持
>>>空闲：立即发送帧
>>>忙：继续坚持监听

>>2）非坚持
>>>空闲：立即发送数据帧
>>> 忙：放弃监听，等待一个随机的时间再次监听
 
>>3）p-坚持
>>>空闲：以概率p发送，以概率1-p推迟到下一个时隙
>>> 忙：持续监听，直到信道空闲

>>CSMA/CD(collsion detection)
>>>冲突检测就是边发送边监听，检测到冲突后则终止传输，减少信道的浪费。如果产生冲突使用二进制退避算法。
>>>
>>>一个问题：
>>>>假设网络带宽为R bps，数据帧最小长度为$L_{min}$(bits),信号传播速度为V(m/s)
>>>>发送结点A到B的距离为$d_{max}$
>>>>单程传播时延:$t = d_{max}/v$
>>>>结点A在发送数据帧后最多经过2t的时间就能够知道发送的帧有没有发生碰撞(当A发生的帧到达经过时间t到达B时，B也发送一个数据帧，经过时间t到达A，此时A检测到发送了冲突，总共2t)，<mark style="background: #FF5582A6;">2t为争用期，只有经过争用期后还未检测到冲突才能够确认没有产生冲突。</mark>
>>>>
>>>>为了使得A发送数据帧完毕之前就能够检测到冲突，因此数据帧大小需要满足$L/R\geq2t$
>>>>
>>>>这样最小数据帧大小满足$L_{min}/R=2d_{max}/V$,
>>>>
>>>>效率：
>>>>$T_{prop}$为LAN中2个结点间的最大传播延迟
>>>>$t_{trans}$为最长帧传输延迟
>>>>效率=$1/(1+5t_{prop}/t_{trans})$
>>>>$t_{prop}$趋近于0或者$t_{trans}$趋近于无穷大时效率接近于1。

 >轮转访问MAC协议：			  
>> 轮询：主节点轮流邀请从节点发送数据
>> 问题：轮询开销、等待延迟、单点故障
>> 
>>令牌传递协议：主要作用在令牌环局域网中
>>>一个令牌沿着环形总线在各结点依次传递，令牌是一个特殊的MAC控制帧，本身不包含信息，仅控制信道的使用。
>>>
>>>令牌和数据的传递过程如下：
>>>> a）网络空闲时，环路中只有令牌帧在循环传递
>>>> 
>>>> b)  令牌传递到有数据要发送的站点时，该站点就修改令牌中的一个标志位，并在令牌中附加自己需要传输的数据帧，将令牌变成一个数据帧，然后发送出去。
>>>> 
>>>> c）数据帧沿着环路传输，接收的结点一边转发，一遍比较帧的目的地址是否与自己的地址相同，如果相同该结点就复制数据帧。
>>>> 
>>>> d）但数据帧沿着环路传输到源结点，源结点收到后不再转发，同时检验返回的帧查看数据传输过程中是否产生错误，若有错则重传。
>>>> 
>>>> e）完成数据传输后，产生一个新的令牌，并传递给下一个结点

>比特映像介质访问控制协议：
>> a）将时间划分成一系列的预约周期和数据传输周期。
>> b）每个预约周期划分成N个时隙对应N个站
>> c）任何一个站想要发送数据必须在他的时隙到来时发送一个1，
>> d）预约周期结束后，预约过的站按编号顺序发送
>> e）最后一个站发送完数据后开始新一轮的预约周期
		
