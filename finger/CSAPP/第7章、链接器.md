1程序转换处理过程
![[Pasted image 20230616171151.png]]
2.链接器
	1）符号解析
		a) 程序中有定义和引用的符号（包括变量和函数）
		b) 编译器将定义的符号存放在一个符号表中
			i.符号表是一个结构数组，在.symtab 节中
			ii.每个表项包含符号名、长度和位置等信息
			iii.编译器将符号的引用存放在重定位节（.rel.text 和.rel.data）中
		c) 链接器将每个符号的引用都与一个确定的符号定义建立关联
	2）重定位
		a) 将多个代码段与数据段分别合并为一个单独的代码段和数据段
		b) 计算每个定义的符号在虚拟地址空间中的绝对地址
		c) 将可执行文件中符号引用处的地址修改为重定位后的地址信息
 3.符号和符号表
	 1) 三种符号：
		 a) 全局符号（非 static）：由模块 m 定义并能被其他模块引用的符号。例如，非 static C 函数和非 static 的 C 全局变量
			i.强弱特性：函数名和已初始化的全局变量名是强符号。未初始化的全
			 局变量名是弱符号。
			ii.符号处理规则：
				1. 强符号不能多次定义。
				2. 若一个符号被定义为一次强符号和多次弱符号，则按强定义为准。
				3. 若有多个弱符号定义，则任选其中一个
				4. 符号解析时只能有一个确定的定义（即每个符号仅占一处存储空间）。
		b) 外部符号
		c) 局部符号（带 static）：仅有模块 m 定义和引用的本地符号，带 static 的。不是局部变量。
	 4.重定位
		 1) 符号解析完成后，可进行重定位工作，分三步：
			a) 合并相同的节
				i.将集合 E 的所有目标模块中相同的节合并成新节。例如，所有.text 节
					合并作为可执行文件中的.text 节
			b) 对集合 D 中的定义符号进行重定位（确定地址）
				i.确定新节中所有定义符号在虚拟地址空间中的地址。例如，为函数确
				 定首地址，进而确定每条指令的地址，为变量确定首地址
				ii.完成这一步后，每条指令和每个变量的地址都可确定
			c) 对引用符号进行重定位（确定地址）
				i.修改.text 节和.data 节中对每个符号的引用（地址）（需要用到
				 在.rel_data 和.rel_text 节中保存的重定位信息）
				ii.重定位方式有多种，只有绝对地址方式才是将引用处的地址修改为
				与之关联（绑定）的定义处的首地址，而其他重定位方式就不一定是
				这样的。例如 PC 相对地址方式，引用处填写的是一个相对地址。	
		 2) 重定位信息：汇编器遇到引用时，生成一个重定位条目（定义不会生成重定位条目）（具体计算过程详见 ppt26）
			a) 数据引用的重定位条目在.rel_data 节中
			b) 指令（movl 这些）中引用的重定位条目在.rel_text 节中
			c) ELF 重定位条目格式
			i.PC32：PC 相对地址，PC 值通常是下一条指令在内存中的地址。
			ii.32：绝对地址。
		相对地址计算：
			ADD(s):从节头标获知的代码节地址
			ADD(r.symbol)：从节头表和符号表获知的符号地址
			计算过程：
				1）占位符的起始地址：
					refaddr =  ADD(s) + offset
				2)计算相对地址
					\*refptr = (unsigned)(ADD(r.symbol)- 4-redaddr)
		绝对地址计算：
			\*refptr = (unsigned)(ADD(r.symbol)+r.addend)
			
 5.目标文件格式
	 1) 三种目标文件：
		a) 可重定位文件（.o）
		b) 可执行目标文件（a.out、*.exe）
		c) 共享的目标文件（*.so）
	2) 目标文件格式：
		a) 可重定位目标文件（具体详见 ppt12 页）
		b) 可执行目标文件（注意与可重定位目标文件的区别）（ppt29 页）